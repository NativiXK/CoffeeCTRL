{% extends "layout.html" %}

{% block head %}
    <script src="{{ url_for('static', filename='manager/script.js') }}"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='manager/style.css') }}">
{% endblock %}

{% block title %} Coffee {% endblock %}

{% block header %}
    <div class="header-title">
        <div id="header-img">
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 30 30" enable-background="new 0 0 30 30">
                <g>
                  <g>
                    <path fill="#020400" fill-rule="evenodd" d="M29,27H1c-0.552,0-1,0.447-1,1c0,0.553,0.448,1,1,1h9    c0,0.553,0.448,1,1,1h8c0.553,0,1-0.447,1-1h9c0.553,0,1-0.447,1-1C30,27.447,29.553,27,29,27z M11.153,25h7.695    c1.359-0.682,2.567-1.713,3.545-3H26c2.209,0,4-1.791,4-4s-1.791-4-4-4c-0.35,0-0.684,0.06-1.007,0.144    C24.994,14.069,25,13.997,25,13.923C25,13.413,24.656,13,24.23,13H5.769C5.344,13,5,13.413,5,13.923    C5,18.914,7.54,23.191,11.153,25z M24.776,16.429C25.115,16.164,25.537,16,26,16c1.104,0,2,0.896,2,2s-0.896,2-2,2h-2.379    C24.156,18.908,24.55,17.706,24.776,16.429z M23,15c0,4.418-3.582,8-8,8c-4.419,0-8-3.582-8-8H23z M20,8    c0,0.725-0.357,0.862-0.587,1.486c-0.057,0.103-0.089,0.215-0.097,0.339C19.281,10.416,19.533,11,20.4,11    c0.441,0,0.625-0.453,0.8-0.75C21.535,9.719,22,8.917,22,8c0-1.265-0.418-1.838-0.832-2.562C20.69,4.601,20,4.371,20,3    c0-0.73,0.435-0.96,0.662-1.6c0.055-0.102,0.082-0.211,0.092-0.332C20.789,0.654,20.432,0,19.6,0c-0.441,0-0.6,0.383-0.8,0.75    C18.486,1.349,18,2.072,18,3c0,1.478,0.44,1.749,0.852,2.438C19.268,6.131,20,6.735,20,8z M15,8c0,0.725-0.357,0.862-0.587,1.486    c-0.057,0.103-0.089,0.215-0.096,0.339C14.281,10.416,14.533,11,15.4,11c0.441,0,0.625-0.453,0.8-0.75C16.535,9.719,17,8.917,17,8    c0-1.265-0.418-1.838-0.832-2.562C15.69,4.601,15,4.371,15,3c0-0.73,0.435-0.96,0.662-1.6c0.055-0.102,0.082-0.211,0.092-0.332    C15.789,0.654,15.432,0,14.6,0c-0.441,0-0.6,0.383-0.8,0.75C13.486,1.349,13,2.072,13,3c0,1.478,0.44,1.749,0.852,2.438    C14.267,6.131,15,6.735,15,8z M10,8c0,0.725-0.358,0.862-0.587,1.486C9.356,9.59,9.324,9.701,9.317,9.825    C9.281,10.416,9.533,11,10.4,11c0.442,0,0.625-0.453,0.8-0.75C11.535,9.719,12,8.917,12,8c0-1.265-0.419-1.838-0.833-2.562    C10.69,4.601,10,4.371,10,3c0-0.73,0.435-0.96,0.663-1.6c0.054-0.102,0.081-0.211,0.091-0.332C10.79,0.654,10.431,0,9.6,0    C9.158,0,9,0.383,8.8,0.75C8.486,1.349,8,2.072,8,3c0,1.478,0.44,1.749,0.852,2.438C9.267,6.131,10,6.735,10,8z"/>
                  </g>
                </g>
              </svg>
        </div>
        <h2 id="header-title-text">Coffee manager</h2>
    </div>

    <div class="header-tools">
        <button class="btn btn-success" id="btn-add-person">Add user</button>
        <button class="btn btn-warning" id="btn-shop">Shop</button>
        <button class="btn btn-secondary" id="btn-logout">Logout</button>
    </div>

    <div id="header-filter">
        <form class="input-group" action="/edit" method="post">
            <input autofocus class="form-control w-75" type="text" name="name" placeholder="Nome" aria-label="name" aria-describedby="button-addon2">
            <div class="input-group-append">
                <input class="btn btn-primary" id="button-addon2" type="submit" title="Filtrar" value="Filtrar">
            </div>
        </form>
    </div>
{% endblock %}

{% block body %}
<div id="coffee-table" class="card">
    <table class="table table-striped table-hover text-center">
        <thead class="thead-dark">
            <tr>
                <th scope="col" hidden>ID</th>
                <th scope="col" class="col-name">Nome</th>
                <th scope="col">Jan</th>
                <th scope="col">Fev</th>
                <th scope="col">Mar</th>
                <th scope="col">Abr</th>
                <th scope="col">Mai</th>
                <th scope="col">Jun</th>
                <th scope="col">Jul</th>
                <th scope="col">Ago</th>
                <th scope="col">Set</th>
                <th scope="col">Out</th>
                <th scope="col">Nov</th>
                <th scope="col">Dez</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <!-- onclick="toggle_collapse('collapse{{user.id}}')" -->
            <tr scope="row" id="row-{{user.id}}" onclick="toggle_collapse('collapse{{user.id}}')">
                <th class="col-id" hidden> {{ user.id }} </td>
                <td class="col-name">{{ user.name }}</td>
                {% for month in user.months %}
                    {% if (month.value - month.discount) == 0 %}
                        <td style="background-color: lightgrey;"> - </td>
                    {% elif month.value %}
                        <td style="background-color: lightgreen;">R${{ month.value - month.discount }}</td>    
                    {% else %}
                        <td style="background-color: lightcoral;">R${{ month.value - month.discount }}</td>
                    {% endif %}
                {% endfor %}
            </tr>
            <tr scope="row" style="max-height: min-content;" class="collapse" id="collapse{{user.id}}">
                <td colspan="1" class="user-info">
                    <div class="card card-body p-1 d-flex flex-row justify-content-around">
                        <span><strong>Email: </strong> {{ user.email }}</span><br>
                        <span><strong>Area: </strong> {{ user.area }}</span>
                    </div>
                </td>
                <td colspan="12" >
                    <div class="card card-body p-1 d-flex flex-row justify-content-around h-100">
                        <button class="btn btn-primary user-buttons" id="pay-{{ user.id }}">Payment</button>
                        <button class="btn btn-secondary user-buttons" id="edit-{{ user.id }}">Edit</button>
                        <button class="btn btn-danger user-buttons" id="remove-{{ user.id }}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="white" class="bi bi-trash-fill" viewBox="0 0 16 16">
                                <path d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1H2.5zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zM8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5zm3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0z"/>
                              </svg>
                        </button>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="modal fade" id="PaymentModal" tabindex="-1" aria-labelledby="PaymentModal" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="PaymentModal-title">PAYMENT</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <form action="" id="pay-form">
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="inputGroup-sizing-default">Name</span>
                    </div>
                    <input type="number" id="pay-userid" hidden>
                    <input class="form-control" name="pay-name" id="pay-name" readonly>
                </div>

                <!-- Payment date -->
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="inputGroup-sizing-default">Date</span>
                    </div>
                    <input class="form-control" type="text" name="pay-date" id="pay-date" min="2020-02-20" required>
                </div>

                <!-- Payment value -->
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="inputGroup-sizing-default">Payment</span>
                    </div>
                    <input class="form-control" type="number" min="0" name="pay-value" id="pay-value" placeholder="R$" required>
                </div>

                <!-- Payment discount -->
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="inputGroup-sizing-default">Discount</span>
                    </div>
                    <input class="form-control" type="number" min="0" name="pay-discount" id="pay-discount" placeholder="R$" required>
                </div>

                <!-- Payment confirmation or closure -->
                <div class="input-group mb-3 d-flex justify-content-around">
                    <input class="btn btn-success m-2 mb-2" id="pay-confirm" type="button" value="Confirm">
                    <input class="btn btn-danger m-2 mb-2" type="button" value="Cancel" data-dismiss="modal" aria-label="Close">
                </div>
            </form>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="EditModal" tabindex="-1" aria-labelledby="EditModal" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="EditModal-title">EDIT</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <form action="" id="edit-form">
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="inputGroup-sizing-default">Name</span>
                    </div>
                    <input type="number" id="edit-userid" hidden>
                    <input class="form-control" name="edit-name" id="edit-name">
                </div>

                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="inputGroup-sizing-default">E-mail</span>
                    </div>
                    <input class="form-control" type="email" name="edit-email" id="edit-email">
                </div>

                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="inputGroup-sizing-default">Area</span>
                    </div>
                    <input class="form-control" type="text" name="edit-area" id="edit-area">
                </div>

                <!-- Payment confirmation or closure -->
                <div class="input-group mb-3 d-flex justify-content-around">
                    <input class="btn btn-success m-2 mb-2" id="edit-confirm" type="button" value="Save">
                    <input class="btn btn-danger m-2 mb-2" type="button" value="Cancel" data-dismiss="modal" aria-label="Close">
                </div>
            </form>
        </div>
      </div>
    </div>
  </div>
{% endblock %}